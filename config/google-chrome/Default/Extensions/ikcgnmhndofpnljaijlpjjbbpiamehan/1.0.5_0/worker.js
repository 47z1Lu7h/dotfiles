class Bg{constructor(){this.appWindowId=null,this.windowChangeEvents(),this.onIconClicked(),this.onWindowClose(),this.onMessage(),this.screen={width:null,height:null},chrome.system.display.getInfo(null,(e=>{this.screen=e[0].bounds}))}onIconClicked(){setTimeout((()=>{chrome.action.onClicked.addListener((()=>{this.appWindowId?chrome.windows.update(this.appWindowId,{focused:!0}):chrome.windows.create({type:"popup",url:"https://www.instagram.com/",width:400,height:this.screen.height,left:this.screen.width-400},(e=>{this.appWindowId=e.id,this.appTabId=e.tabs[0].id,setTimeout((()=>{chrome.tabs.reload(this.appTabId,(()=>{}))}),100)}))}))}),500)}onWindowClose(){chrome.windows.onRemoved.addListener((e=>{e===this.appWindowId&&(this.appWindowId=null,this.appTabId=null)}))}onMessage(){chrome.runtime.onMessage.addListener((e=>{if("downloadImg"===e.action)return chrome.downloads.download({url:e.url}),!0;"downloadVideo"===e.action&&this.downloadVideo(e.data),"takeScreenshot"===e.action&&this.takeScreenshot(e)}))}windowChangeEvents(){chrome.windows.onFocusChanged.addListener((e=>{e!==chrome.windows.WINDOW_ID_NONE&&chrome.windows.get(e,(t=>{t.width<520?this.addUserAgent(e):this.removeUserAgent(e)}))}))}addUserAgent(){this.rules={removeRuleIds:[1],addRules:[{id:1,priority:1,action:{type:"modifyHeaders",requestHeaders:[{header:"user-agent",operation:"set",value:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/21A5326a"}]},condition:{resourceTypes:["main_frame","sub_frame","stylesheet","script","image","font","object","xmlhttprequest","ping","csp_report","media","websocket","other"],urlFilter:"*://*.instagram.com/*"}}]},chrome.declarativeNetRequest.updateSessionRules(this.rules,(()=>{}))}removeUserAgent(){chrome.declarativeNetRequest.updateSessionRules({removeRuleIds:[1]},(()=>{}))}takeScreenshot(e){chrome.tabs.captureVisibleTab(null,{format:e.imgFormat},(t=>{var o=document.createElement("a");o.setAttribute("download","screenshot."+e.imgFormat),o.setAttribute("href",t),document.body.appendChild(o),o.click(),o.remove()}))}downloadVideo({title:e,url:t}){const o=e+".mp4";chrome.downloads.download({url:t,filename:o})}}const b=new Bg;