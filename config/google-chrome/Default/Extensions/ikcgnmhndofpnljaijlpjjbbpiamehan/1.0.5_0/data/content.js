class Content{constructor(){document.documentElement.classList.contains("mobile_mode")&&"/tv/upload/"!==location.pathname&&(this.storage={darkTheme:!1},this.headSelector="._ab16",this.leftHeadSelector="._ab18._ab19",this.rightHeadSelector="._ab18._ab1b",this.initHandlers(),this.initStorage(),this.renderBtns(),setInterval(function(){this.renderBtns()}.bind(this),100),setInterval(function(){this.search()}.bind(this),1e3))}initHandlers(){const t=$(document.body);$(t).on("click",".icon-back",function(){this.incrementCounter(),history.back()}.bind(this)),$(t).on("click",".icon-forward",function(){this.incrementCounter(),history.forward()}.bind(this)),$(t).on("click",".icon-refresh",function(){this.incrementCounter(),location.reload()}.bind(this)),$(t).on("click",".icon-moon",function(){this.changeTheme(),this.incrementCounter()}.bind(this)),$(t).on("click",".icon-screen",function(){this.takeScreenshot(),this.incrementCounter()}.bind(this)),$(t).on("click",".inst-dwn",(function(t){t.stopPropagation(),t.preventDefault();const e=this.getAttribute("url");chrome.runtime.sendMessage({action:"downloadImg",url:e})}))}initStorage(){chrome.storage.local.get(this.storage,function(t){this.storage=t,this.applyTheme()}.bind(this))}renderBtns(){const t=$(this.headSelector);t.find("._abm0").remove(),t.find(".icon-moon").length||(t.find("._aalh").length?(this.$refreshTpl.prependTo(this.leftHeadSelector),this.$forwardTpl.prependTo(this.leftHeadSelector),this.$backTpl.prependTo(this.leftHeadSelector),this.$moonTpl.appendTo(this.rightHeadSelector)):(this.$refreshTpl.prependTo(this.headSelector),this.$forwardTpl.prependTo(this.headSelector),this.$backTpl.prependTo(this.headSelector),this.$screenTpl.appendTo(this.headSelector),this.$moonTpl.appendTo(this.headSelector),$("._ab18._ab19").hide()))}get $refreshTpl(){return $('<div class="icon icon-refresh"></div>')}get $forwardTpl(){return $('<div class="icon icon-forward"></div>')}get $backTpl(){return $('<div class="icon icon-back"></div>')}get $moonTpl(){return $('<div class="icon icon-moon"></div>')}get $screenTpl(){return $('<div class="icon icon-screen"></div>')}applyTheme(){const t=localStorage.getItem("igt")||"light",e=document.body;e.classList.remove("dark-theme","light-theme"),e.classList.add(t+"-theme"),"dark"===t?document.documentElement.classList.add("dark_mode"):document.documentElement.classList.remove("dark_mode")}changeTheme(){const t=localStorage.getItem("igt")||"light";window.location.reload();const e="light"===t?"dark":"light";localStorage.setItem("igt",e),this.storage.darkTheme="dark"===e,this.saveStorage(),this.applyTheme()}saveStorage(){chrome.storage.local.set(this.storage)}takeScreenshot(){chrome.runtime.sendMessage({action:"takeScreenshot",imgFormat:"png"},(function(){}))}search(){const t=window.location.href,e=t.endsWith("https://www.instagram.com/"),n=t.includes("https://www.instagram.com/stories"),i=t.startsWith("https://www.instagram.com/p/"),s=t.includes("https://www.instagram.com/reels");e||n||i?($("article._ab6k ._aatk ._aagv img, article._aa6a ._aatk ._aagv img, article._aatb ._aatk ._aagv img").not(".inst-dwn-init").each(function(t,e){let n=$(e),i=this.getImgUrl(n);n.siblings(".inst-dwn").length||(this.$downloadBtn(i).insertAfter(n),n.addClass("inst-dwn-init"))}.bind(this)),$("._aagv > img").not(".inst-dwn-init").each(function(t,e){let n=$(e),i=this.getImgUrl(n);n.siblings(".inst-dwn").length||(this.$downloadBtn(i).insertAfter(n),n.addClass("inst-dwn-init"))}.bind(this)),$("._aa64 img ").not(".inst-dwn-init").each(function(t,e){let n=$(e),i=this.getImgUrl(n);n.siblings(".inst-dwn").length||(this.$downloadBtn(i).insertAfter(n),n.addClass("inst-dwn-init"))}.bind(this)),$(".x5yr21d.x1uhb9sk.xh8yej3 > video").not(".inst-dwn-init").each(function(t,e){let n=$(e),i=n.attr("src")||n[0].currentSrc;n.siblings(".inst-dwn").length||(this.$downloadBtn(i).insertAfter(n),n.addClass("inst-dwn-init"))}.bind(this))):s||clearInterval(this.search)}$downloadBtn(t){return $(`<div class="inst-dwn" url="${t}"><div class="inst-dwn-icon"></div></div>`)}getImgUrl(t){return(t.attr("src")||t.attr("srcset")).split(",").pop().replace(/ \w+/g," ")}incrementCounter(){let t=+localStorage.getItem("mtz-inst-03-09-22")||0;t++,localStorage.setItem("mtz-inst-03-09-22",String(t)),7!==t&&27!==t&&47!==t&&100!==t||new ShareModal}}new Content;