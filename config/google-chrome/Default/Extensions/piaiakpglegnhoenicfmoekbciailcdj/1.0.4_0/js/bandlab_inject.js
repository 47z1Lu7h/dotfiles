!function(){const e=(e,t=null)=>{},t=(e,t=null)=>{};document.addEventListener("bandlab_video_download",(function(o){((o,n="",s,d)=>{let i=[],a=0,r=null,l="mp4",c="";c=o.startsWith("blob")?o.split("/").pop()+"."+l:(Math.random()+1).toString(36).substring(2,10)+"."+l,e(`URL: ${o}`,c);const h=()=>{fetch(o,{method:"GET",mode:"no-cors",headers:{Range:`bytes=${a}-`},"User-Agent":"User-Agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/117.0"}).then((o=>{if(![200,206].includes(o.status))throw new Error("Non 200/206 response was received: "+o.status);const i=o.headers.get("Content-Type").split(";")[0];l=i.split("/")[1],c=c.substring(0,c.indexOf(".")+1)+l;const h=o.headers.get("Content-Range").match(match_regexp),p=parseInt(h[1]),b=parseInt(h[2]),g=parseInt(h[3]);if(p!==a)throw t("Gap detected between responses.",c),e("Last offset: "+a,c),e("New start offset "+h[1],c),"Gap detected between responses.";if(r&&g!==r)throw t("Total size differs",c),"Total size differs";if(a=b+1,r=g,e(`Get response: ${o.headers.get("Content-Length")} bytes data from ${o.headers.get("Content-Range")}`,c),e(`Progress: ${(100*a/r).toFixed(0)}%`,c),""!=n){let e=new CustomEvent(n+"_bandlab_progress",{detail:{video_id:n,progress:(100*a/r).toFixed(0),page:s,download_id:d}});document.dispatchEvent(e)}return o.blob()})).then((e=>{i.push(e)})).then((()=>{if(!r)throw new Error("_total_size is NULL");a<r?h():p()})).catch((e=>{t(e,c)}))},p=()=>{e("Finish downloading blobs",c),e("Concatenating blobs and downloading...",c);const t=new Blob(i,{type:"video/mp4"}),o=window.URL.createObjectURL(t);e("Final blob size: "+t.size+" bytes",c);const n=document.createElement("a");document.body.appendChild(n),n.href=o,n.download=c,n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o),e("Download triggered",c)};h()})(o.detail.video_src.video_url,o.detail.video_src.video_id,o.detail.video_src.page,o.detail.video_src.download_id)}))}();