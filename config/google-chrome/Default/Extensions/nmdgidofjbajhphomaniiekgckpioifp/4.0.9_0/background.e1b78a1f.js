(()=>{const t=/Chrome/.test(navigator.userAgent);function e(t,e,s,n){let c={swatch:{hue:t,saturation:e,lightness:s,chosenId:n},hsl:"",lightnessShift:"",hueHovered:"",hueVisited:"",alpha:""};return a(c),c}function a(t){t.hsl=`hsl(${t.swatch.hue}, ${t.swatch.saturation}%, ${t.swatch.lightness}%)`,t.swatch.lightness>=50?t.lightnessShift=`hsl(${t.swatch.hue}, ${t.swatch.saturation}%, ${t.swatch.lightness-10}%)`:t.lightnessShift=`hsl(${t.swatch.hue}, ${t.swatch.saturation}%, ${t.swatch.lightness+10}%)`,t.hueHovered=`hsl(${t.swatch.hue+40}, ${t.swatch.saturation+20}%, ${t.swatch.lightness}%)`,t.hueVisited=`hsl(${t.swatch.hue-40}, ${t.swatch.saturation+20}%, ${t.swatch.lightness}%)`,t.alpha=`hsla(${t.swatch.hue}, ${t.swatch.saturation}%, ${t.swatch.lightness}%, 0.5)`}function s(t){return!!t.activeTabHostname&&(!!t.activeTabId&&!!t.hosts.includes(t.activeTabHostname))}function n(e){t?chrome.storage.sync.set({colorChangerState:e}):browser.storage.sync.set({colorChangerState:e})}const c="UPDATE_CONTENT",i="CHANGE_COLORS",o=-9999,h="fore",r="back",l="link",g={activeTabId:o,activeTabHostname:"",fg:e(0,0,80,"zero"),bg:e(0,0,25,"zero"),li:e(68,80,80,"2-6"),activeBtn:h,lightness:80,hosts:[],lostConnection:!1,invalidUrl:!1};let u=JSON.parse(JSON.stringify(g));function d(t){u.activeTabHostname&&u.activeTabId&&(t&&!u.hosts.includes(u.activeTabHostname)?u.hosts.push(u.activeTabHostname):u.hosts=[...u.hosts.filter((t=>t!==u.activeTabHostname))],T(),v({message:c,payload:u}),n(u))}function b(t,e){t.swatch.hue=e.hue,t.swatch.saturation=e.saturation,t.swatch.lightness=e.lightness,t.swatch.chosenId=e.id,a(t)}function m(t){if(u.invalidUrl=!1,u.lostConnection=!1,n(u),!t.url)return;let e=new URL(t.url);e.hostname&&"chrome:"!==e.protocol&&"about:"!==e.protocol&&"addons.mozilla.org"!==e.hostname?(u.activeTabHostname=e.hostname,n(u),T(),v({message:c,payload:u})):w()}function w(){u.activeTabHostname="",u.invalidUrl=!0,n(u)}async function v(t){if(u.activeTabId)try{await chrome.tabs.sendMessage(u.activeTabId,t)}catch(t){u.lostConnection=!0,n(u)}}function f(t,e){t.menuItemId===i&&d(!!t.checked)}function T(){chrome.contextMenus.update(i,{checked:s(u)})}chrome.tabs.onActivated.addListener((function(t){u.activeTabId=t.tabId,n(u),chrome.tabs.get(t.tabId,m)})),chrome.tabs.onUpdated.addListener((function(t,e,a){u.activeTabId===o?(u.activeTabId=t,m(a)):u.activeTabId===t&&m(a)})),chrome.runtime.onMessage.addListener((function(t,e,s){switch(t.message){case"GET_STATE":s(u);break;case i:d(t.payload);break;case"SET_ACTIVE_BUTTON":!function(t){u.activeBtn=t,t==h?u.lightness=u.fg.swatch.lightness:t==r?u.lightness=u.bg.swatch.lightness:t==l&&(u.lightness=u.li.swatch.lightness);n(u)}(t.payload);break;case"UPDATE_CHOSEN_COLOR":!function(t){switch(u.activeBtn){case h:b(u.fg,t);break;case r:b(u.bg,t);break;case l:b(u.li,t)}v({message:c,payload:u}),n(u)}(t.payload);break;case"CHANGE_LIGHTNESS":!function(t){switch(u.lightness=t,u.activeBtn){case h:u.fg.swatch.lightness=t,a(u.fg);break;case r:u.bg.swatch.lightness=t,a(u.bg);break;case l:u.li.swatch.lightness=t,a(u.li)}n(u),v({message:c,payload:u})}(t.payload);break;case"RESET":!function(){let t=JSON.parse(JSON.stringify(g));u.hosts=t.hosts,u.fg=t.fg,u.bg=t.bg,u.li=t.li,u.activeBtn=t.activeBtn,u.lightness=t.lightness,u.lostConnection=t.lostConnection,u.invalidUrl=t.invalidUrl,T(),v({message:c,payload:u}),n(u)}()}return!0})),chrome.runtime.onInstalled.addListener((function(t){"update"===t.reason||t.reason})),async function(){let e=await(t?chrome.storage.sync.get(["colorChangerState"]):browser.storage.sync.get(["colorChangerState"]));e?.colorChangerState&&(u=e.colorChangerState),u.activeTabId=o,u.activeTabHostname="";let a=await(c={currentWindow:!0,active:!0},t?chrome.tabs.query(c):browser.tabs.query(c));var c;if(a.length>0){let t=a[0];t.id&&(u.activeTabId=t.id,m(t))}!function(){let t={id:i,title:"Change Colors",type:"checkbox",checked:s(u)};chrome.contextMenus.removeAll(),chrome.contextMenus.create(t),chrome.contextMenus.onClicked.removeListener(f),chrome.contextMenus.onClicked.addListener(f)}(),n(u)}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YUFBQWdDLFVBQUFDLGVBQUF0QyxHQUNQNUMsT0FBSWlELGFBQWVnQyxVQUFLN0IsWUFBQVIsRSxDQThEMUJ1QyxHQUdBcEYsRUFBd0JvQixFIiwic291cmNlcyI6WyJ1dGlscy50cyIsImNvbnN0YW50cy50cyIsImJhY2tncm91bmQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29sb3IsIE1lc3NhZ2UsIFN0YXRlIH0gZnJvbSBcIi4vaW50ZXJmYWNlc1wiO1xyXG5cclxuZXhwb3J0IGNvbnN0IGlzQ2hyb21lID0gL0Nocm9tZS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDb2xvcihodWU6IG51bWJlciwgc2F0dXJhdGlvbjogbnVtYmVyLCBsaWdodG5lc3M6IG51bWJlciwgY2hvc2VuSWQ6IHN0cmluZyk6IENvbG9yIHtcclxuICBsZXQgY29sb3I6IENvbG9yID0ge1xyXG4gICAgc3dhdGNoOiB7XHJcbiAgICAgIGh1ZSxcclxuICAgICAgc2F0dXJhdGlvbixcclxuICAgICAgbGlnaHRuZXNzLFxyXG4gICAgICBjaG9zZW5JZCxcclxuICAgIH0sXHJcbiAgICBoc2w6IFwiXCIsXHJcbiAgICBsaWdodG5lc3NTaGlmdDogXCJcIixcclxuICAgIGh1ZUhvdmVyZWQ6IFwiXCIsXHJcbiAgICBodWVWaXNpdGVkOiBcIlwiLFxyXG4gICAgYWxwaGE6IFwiXCIsXHJcbiAgfVxyXG4gIHNldEhzbFN0cmluZ3MoY29sb3IpO1xyXG4gIHJldHVybiBjb2xvcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldEhzbFN0cmluZ3MoY29sb3I6IENvbG9yKSB7XHJcbiAgY29sb3IuaHNsID0gYGhzbCgke2NvbG9yLnN3YXRjaC5odWV9LCAke2NvbG9yLnN3YXRjaC5zYXR1cmF0aW9ufSUsICR7Y29sb3Iuc3dhdGNoLmxpZ2h0bmVzc30lKWA7XHJcbiAgaWYgKGNvbG9yLnN3YXRjaC5saWdodG5lc3MgPj0gNTApIHtcclxuICAgIGNvbG9yLmxpZ2h0bmVzc1NoaWZ0ID0gYGhzbCgke2NvbG9yLnN3YXRjaC5odWV9LCAke2NvbG9yLnN3YXRjaC5zYXR1cmF0aW9ufSUsICR7Y29sb3Iuc3dhdGNoLmxpZ2h0bmVzcyAtIDEwfSUpYDtcclxuICB9IGVsc2Uge1xyXG4gICAgY29sb3IubGlnaHRuZXNzU2hpZnQgPSBgaHNsKCR7Y29sb3Iuc3dhdGNoLmh1ZX0sICR7Y29sb3Iuc3dhdGNoLnNhdHVyYXRpb259JSwgJHtjb2xvci5zd2F0Y2gubGlnaHRuZXNzICsgMTB9JSlgO1xyXG4gIH1cclxuICBjb2xvci5odWVIb3ZlcmVkID0gYGhzbCgke2NvbG9yLnN3YXRjaC5odWUgKyA0MCAlIDM2MH0sICR7Y29sb3Iuc3dhdGNoLnNhdHVyYXRpb24gKyAyMH0lLCAke2NvbG9yLnN3YXRjaC5saWdodG5lc3N9JSlgO1xyXG4gIGNvbG9yLmh1ZVZpc2l0ZWQgPSBgaHNsKCR7Y29sb3Iuc3dhdGNoLmh1ZSAtIDQwICUgMzYwfSwgJHtjb2xvci5zd2F0Y2guc2F0dXJhdGlvbiArIDIwfSUsICR7Y29sb3Iuc3dhdGNoLmxpZ2h0bmVzc30lKWA7XHJcbiAgY29sb3IuYWxwaGEgPSBgaHNsYSgke2NvbG9yLnN3YXRjaC5odWV9LCAke2NvbG9yLnN3YXRjaC5zYXR1cmF0aW9ufSUsICR7Y29sb3Iuc3dhdGNoLmxpZ2h0bmVzc30lLCAwLjUpYDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNob3VsZENoYW5nZUNvbG9ycyhzdGF0ZTogU3RhdGUpOiBib29sZWFuIHtcclxuICBpZiAoIXN0YXRlLmFjdGl2ZVRhYkhvc3RuYW1lKSByZXR1cm4gZmFsc2U7XHJcbiAgaWYgKCFzdGF0ZS5hY3RpdmVUYWJJZCkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICBpZiAoc3RhdGUuaG9zdHMuaW5jbHVkZXMoc3RhdGUuYWN0aXZlVGFiSG9zdG5hbWUpKSB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufVxyXG5cclxuLyoqIFdvcmthcm91bmQgZm9yIG5vdCBiZWluZyBhYmxlIHRvIGF3YWl0IGFuIGFzeW5jIG1lc3NhZ2Ugd2l0aCBjaHJvbWUucnVudGltZSBpbiBGaXJlZm94LlxyXG4gKiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD0xMjI4MDQ0XHJcbiovXHJcbmV4cG9ydCBmdW5jdGlvbiBydW50aW1lU2VuZE1lc3NhZ2UobWVzc2FnZTogTWVzc2FnZSk6IFByb21pc2U8YW55PiB7XHJcbiAgaWYgKGlzQ2hyb21lKSB7XHJcbiAgICByZXR1cm4gY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBicm93c2VyLnJ1bnRpbWUuc2VuZE1lc3NhZ2UobWVzc2FnZSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2F2ZVN0YXRlKHN0YXRlOiBTdGF0ZSkge1xyXG4gIGlmIChpc0Nocm9tZSkge1xyXG4gICAgY2hyb21lLnN0b3JhZ2Uuc3luYy5zZXQoeyAnY29sb3JDaGFuZ2VyU3RhdGUnOiBzdGF0ZSB9KTtcclxuICB9IGVsc2Uge1xyXG4gICAgYnJvd3Nlci5zdG9yYWdlLnN5bmMuc2V0KHsgJ2NvbG9yQ2hhbmdlclN0YXRlJzogc3RhdGUgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3RhdGUoKSB7XHJcbiAgaWYgKGlzQ2hyb21lKSB7XHJcbiAgICByZXR1cm4gY2hyb21lLnN0b3JhZ2Uuc3luYy5nZXQoWydjb2xvckNoYW5nZXJTdGF0ZSddKTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIGJyb3dzZXIuc3RvcmFnZS5zeW5jLmdldChbJ2NvbG9yQ2hhbmdlclN0YXRlJ10pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRhYnNRdWVyeShxdWVyeTogYW55KSB7XHJcbiAgaWYgKGlzQ2hyb21lKSB7XHJcbiAgICByZXR1cm4gY2hyb21lLnRhYnMucXVlcnkocXVlcnkpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gYnJvd3Nlci50YWJzLnF1ZXJ5KHF1ZXJ5KSBhcyBQcm9taXNlPGNocm9tZS50YWJzLlRhYltdPjtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgU3RhdGUgfSBmcm9tIFwiLi9pbnRlcmZhY2VzXCI7XHJcbmltcG9ydCB7IGNyZWF0ZUNvbG9yIH0gZnJvbSBcIi4vdXRpbHNcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBHRVRfU1RBVEUgPSBcIkdFVF9TVEFURVwiO1xyXG5leHBvcnQgY29uc3QgVVBEQVRFX0NPTlRFTlQgPSBcIlVQREFURV9DT05URU5UXCI7XHJcbmV4cG9ydCBjb25zdCBDSEFOR0VfQ09MT1JTID0gXCJDSEFOR0VfQ09MT1JTXCI7XHJcbmV4cG9ydCBjb25zdCBTRVRfQUNUSVZFX0JVVFRPTiA9IFwiU0VUX0FDVElWRV9CVVRUT05cIjtcclxuZXhwb3J0IGNvbnN0IFVQREFURV9DSE9TRU5fQ09MT1IgPSBcIlVQREFURV9DSE9TRU5fQ09MT1JcIjtcclxuZXhwb3J0IGNvbnN0IENIQU5HRV9MSUdIVE5FU1MgPSBcIkNIQU5HRV9MSUdIVE5FU1NcIjtcclxuZXhwb3J0IGNvbnN0IFJFU0VUID0gXCJSRVNFVFwiO1xyXG5leHBvcnQgY29uc3QgQ09OVEVOVF9DT05ORUNURUQgPSBcIkNPTlRFTlRfQ09OTkVDVEVEXCI7XHJcbmV4cG9ydCBjb25zdCBJTlZBTElEX1RBQiA9IC05OTk5O1xyXG5cclxuZXhwb3J0IGNvbnN0IEZPUkVfQlROID0gXCJmb3JlXCI7XHJcbmV4cG9ydCBjb25zdCBCQUNLX0JUTiA9IFwiYmFja1wiO1xyXG5leHBvcnQgY29uc3QgTElOS19CVE4gPSBcImxpbmtcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBDT0xPUl9DSEFOR0VSX1NUWUxFX0lEID0gXCJjb2xvci1jaGFuZ2VyLXN0eWxlXCI7XHJcbmV4cG9ydCBjb25zdCBDT0xPUl9DSEFOR0VSX0NMQVNTX05BTUUgPSBcImNvbG9yLWNoYW5nZXItdjRcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX1NUQVRFOiBTdGF0ZSA9IHtcclxuICBhY3RpdmVUYWJJZDogSU5WQUxJRF9UQUIsXHJcbiAgYWN0aXZlVGFiSG9zdG5hbWU6IFwiXCIsXHJcbiAgZmc6IGNyZWF0ZUNvbG9yKDAsIDAsIDgwLCAnemVybycpLFxyXG4gIGJnOiBjcmVhdGVDb2xvcigwLCAwLCAyNSwgJ3plcm8nKSxcclxuICBsaTogY3JlYXRlQ29sb3IoNjgsIDgwLCA4MCwgJzItNicpLFxyXG4gIGFjdGl2ZUJ0bjogRk9SRV9CVE4sXHJcbiAgbGlnaHRuZXNzOiA4MCxcclxuICBob3N0czogW10sXHJcbiAgbG9zdENvbm5lY3Rpb246IGZhbHNlLFxyXG4gIGludmFsaWRVcmw6IGZhbHNlLFxyXG59XHJcbiIsIlxyXG5pbXBvcnQgeyBCQUNLX0JUTiwgQ0hBTkdFX0NPTE9SUywgQ0hBTkdFX0xJR0hUTkVTUywgQ09OVEVOVF9DT05ORUNURUQsIERFRkFVTFRfU1RBVEUsIEZPUkVfQlROLCBHRVRfU1RBVEUsIElOVkFMSURfVEFCLCBMSU5LX0JUTiwgUkVTRVQsIFNFVF9BQ1RJVkVfQlVUVE9OLCBVUERBVEVfQ0hPU0VOX0NPTE9SLCBVUERBVEVfQ09OVEVOVCB9IGZyb20gXCIuL2NvbnN0YW50c1wiO1xyXG5pbXBvcnQgeyBDYW52YXNTd2F0Y2gsIENvbG9yLCBNZXNzYWdlLCBTdGF0ZSB9IGZyb20gXCIuL2ludGVyZmFjZXNcIjtcclxuaW1wb3J0IHsgZ2V0U3RhdGUsIHNhdmVTdGF0ZSwgc2V0SHNsU3RyaW5ncywgc2hvdWxkQ2hhbmdlQ29sb3JzLCB0YWJzUXVlcnkgfSBmcm9tIFwiLi91dGlsc1wiO1xyXG5cclxubGV0IHN0YXRlOiBTdGF0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoREVGQVVMVF9TVEFURSkpO1xyXG5jb25zdCBsb2dzID0gZmFsc2U7XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gYWN0aW9uc1xyXG5mdW5jdGlvbiBvbk1lc3NhZ2UobWVzc2FnZTogTWVzc2FnZSwgX3NlbmRlcjogYW55LCBzZW5kUmVzcG9uc2U6IGFueSkge1xyXG4gIHN3aXRjaCAobWVzc2FnZS5tZXNzYWdlKSB7XHJcbiAgICBjYXNlIEdFVF9TVEFURToge1xyXG4gICAgICBzZW5kUmVzcG9uc2Uoc3RhdGUpXHJcbiAgICB9OyBicmVhaztcclxuICAgIGNhc2UgQ0hBTkdFX0NPTE9SUzoge1xyXG4gICAgICBvbkNoYW5nZUNvbG9ycyhtZXNzYWdlLnBheWxvYWQpO1xyXG4gICAgfTsgYnJlYWs7XHJcbiAgICBjYXNlIFNFVF9BQ1RJVkVfQlVUVE9OOiB7XHJcbiAgICAgIG9uU2V0QWN0aXZlQnV0dG9uKG1lc3NhZ2UucGF5bG9hZCk7XHJcbiAgICB9OyBicmVhaztcclxuICAgIGNhc2UgVVBEQVRFX0NIT1NFTl9DT0xPUjoge1xyXG4gICAgICBvblVwZGF0ZUNob3NlbkNvbG9yKG1lc3NhZ2UucGF5bG9hZCk7XHJcbiAgICB9OyBicmVhaztcclxuICAgIGNhc2UgQ0hBTkdFX0xJR0hUTkVTUzoge1xyXG4gICAgICBvbkNoYW5nZUxpZ2h0bmVzcyhtZXNzYWdlLnBheWxvYWQpO1xyXG4gICAgfTsgYnJlYWs7XHJcbiAgICBjYXNlIFJFU0VUOiB7XHJcbiAgICAgIG9uUmVzZXQoKTtcclxuICAgIH07IGJyZWFrO1xyXG4gICAgLy8gY2FzZSBDT05URU5UX0NPTk5FQ1RFRDoge1xyXG4gICAgLy8gICBzdGF0ZS5sb3N0Q29ubmVjdGlvbiA9IGZhbHNlO1xyXG4gICAgLy8gICBzYXZlU3RhdGUoc3RhdGUpO1xyXG4gICAgLy8gfTsgYnJlYWs7XHJcbiAgICBkZWZhdWx0OiBicmVhaztcclxuICB9XHJcblxyXG4gIC8vIEFsbG93cyB0aGUgY2FsbGVyIHRvIGF3YWl0IGEgcmVzcG9uc2UuXHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9uQ2hhbmdlQ29sb3JzKGNoYW5nZUNvbG9yczogYm9vbGVhbikge1xyXG4gIGxvZ3MgJiYgY29uc29sZS5sb2coJ3N0YXRlLmFjdGl2ZVRhYkhvc3RuYW1lJywgc3RhdGUuYWN0aXZlVGFiSG9zdG5hbWUsICdzdGF0ZS5hY3RpdmVUYWJJZCcsIHN0YXRlLmFjdGl2ZVRhYklkKTtcclxuICBpZiAoIXN0YXRlLmFjdGl2ZVRhYkhvc3RuYW1lKSB7XHJcbiAgICBsb2dzICYmIGNvbnNvbGUubG9nKCdvbkNoYW5nZUNvbG9ycyAtIE5vIGhvc3RuYW1lJyk7XHJcbiAgICByZXR1cm5cclxuICB9O1xyXG5cclxuICBpZiAoIXN0YXRlLmFjdGl2ZVRhYklkKSB7XHJcbiAgICBsb2dzICYmIGNvbnNvbGUubG9nKCdvbkNoYW5nZUNvbG9ycyAtIE5vIHRhYiBJRC4nKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGlmIChjaGFuZ2VDb2xvcnMgJiYgIXN0YXRlLmhvc3RzLmluY2x1ZGVzKHN0YXRlLmFjdGl2ZVRhYkhvc3RuYW1lKSkge1xyXG4gICAgc3RhdGUuaG9zdHMucHVzaChzdGF0ZS5hY3RpdmVUYWJIb3N0bmFtZSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHN0YXRlLmhvc3RzID0gWy4uLnN0YXRlLmhvc3RzLmZpbHRlcigoaG9zdCkgPT4gaG9zdCAhPT0gc3RhdGUuYWN0aXZlVGFiSG9zdG5hbWUpXTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZUNvbnRleHRNZW51KCk7XHJcbiAgc2VuZFRhYk1lc3NhZ2UoeyBtZXNzYWdlOiBVUERBVEVfQ09OVEVOVCwgcGF5bG9hZDogc3RhdGUgfSk7XHJcbiAgc2F2ZVN0YXRlKHN0YXRlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gb25TZXRBY3RpdmVCdXR0b24oYnV0dG9uOiBzdHJpbmcpIHtcclxuICBzdGF0ZS5hY3RpdmVCdG4gPSBidXR0b247XHJcblxyXG4gIGlmIChidXR0b24gPT0gRk9SRV9CVE4pIHtcclxuICAgIHN0YXRlLmxpZ2h0bmVzcyA9IHN0YXRlLmZnLnN3YXRjaC5saWdodG5lc3M7XHJcbiAgfSBlbHNlIGlmIChidXR0b24gPT0gQkFDS19CVE4pIHtcclxuICAgIHN0YXRlLmxpZ2h0bmVzcyA9IHN0YXRlLmJnLnN3YXRjaC5saWdodG5lc3M7XHJcbiAgfSBlbHNlIGlmIChidXR0b24gPT0gTElOS19CVE4pIHtcclxuICAgIHN0YXRlLmxpZ2h0bmVzcyA9IHN0YXRlLmxpLnN3YXRjaC5saWdodG5lc3M7XHJcbiAgfVxyXG5cclxuICBzYXZlU3RhdGUoc3RhdGUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvblVwZGF0ZUNob3NlbkNvbG9yKHN3YXRjaDogQ2FudmFzU3dhdGNoKSB7XHJcbiAgc3dpdGNoIChzdGF0ZS5hY3RpdmVCdG4pIHtcclxuICAgIGNhc2UgRk9SRV9CVE46IHtcclxuICAgICAgdXBkYXRlQ29sb3Ioc3RhdGUuZmcsIHN3YXRjaCk7XHJcbiAgICB9IGJyZWFrO1xyXG4gICAgY2FzZSBCQUNLX0JUTjoge1xyXG4gICAgICB1cGRhdGVDb2xvcihzdGF0ZS5iZywgc3dhdGNoKTtcclxuICAgIH0gYnJlYWs7XHJcbiAgICBjYXNlIExJTktfQlROOiB7XHJcbiAgICAgIHVwZGF0ZUNvbG9yKHN0YXRlLmxpLCBzd2F0Y2gpO1xyXG4gICAgfSBicmVhaztcclxuICAgIGRlZmF1bHQ6IGJyZWFrO1xyXG4gIH1cclxuICBzZW5kVGFiTWVzc2FnZSh7IG1lc3NhZ2U6IFVQREFURV9DT05URU5ULCBwYXlsb2FkOiBzdGF0ZSB9KTtcclxuICBzYXZlU3RhdGUoc3RhdGUpO1xyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVDb2xvcihjb2xvcjogQ29sb3IsIHN3YXRjaDogQ2FudmFzU3dhdGNoKSB7XHJcbiAgY29sb3Iuc3dhdGNoLmh1ZSA9IHN3YXRjaC5odWU7XHJcbiAgY29sb3Iuc3dhdGNoLnNhdHVyYXRpb24gPSBzd2F0Y2guc2F0dXJhdGlvbjtcclxuICBjb2xvci5zd2F0Y2gubGlnaHRuZXNzID0gc3dhdGNoLmxpZ2h0bmVzcztcclxuICBjb2xvci5zd2F0Y2guY2hvc2VuSWQgPSBzd2F0Y2guaWQ7XHJcbiAgc2V0SHNsU3RyaW5ncyhjb2xvcik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9uQ2hhbmdlTGlnaHRuZXNzKGxpZ2h0bmVzczogbnVtYmVyKSB7XHJcbiAgc3RhdGUubGlnaHRuZXNzID0gbGlnaHRuZXNzO1xyXG5cclxuICBzd2l0Y2ggKHN0YXRlLmFjdGl2ZUJ0bikge1xyXG4gICAgY2FzZSBGT1JFX0JUTjoge1xyXG4gICAgICBzdGF0ZS5mZy5zd2F0Y2gubGlnaHRuZXNzID0gbGlnaHRuZXNzO1xyXG4gICAgICBzZXRIc2xTdHJpbmdzKHN0YXRlLmZnKTtcclxuICAgIH0gYnJlYWs7XHJcbiAgICBjYXNlIEJBQ0tfQlROOiB7XHJcbiAgICAgIHN0YXRlLmJnLnN3YXRjaC5saWdodG5lc3MgPSBsaWdodG5lc3M7XHJcbiAgICAgIHNldEhzbFN0cmluZ3Moc3RhdGUuYmcpO1xyXG4gICAgfSBicmVhaztcclxuICAgIGNhc2UgTElOS19CVE46IHtcclxuICAgICAgc3RhdGUubGkuc3dhdGNoLmxpZ2h0bmVzcyA9IGxpZ2h0bmVzcztcclxuICAgICAgc2V0SHNsU3RyaW5ncyhzdGF0ZS5saSk7XHJcbiAgICB9IGJyZWFrO1xyXG4gICAgZGVmYXVsdDogYnJlYWs7XHJcbiAgfVxyXG5cclxuICBzYXZlU3RhdGUoc3RhdGUpO1xyXG4gIHNlbmRUYWJNZXNzYWdlKHsgbWVzc2FnZTogVVBEQVRFX0NPTlRFTlQsIHBheWxvYWQ6IHN0YXRlIH0pO1xyXG59XHJcblxyXG4vKiogU2V0cyBiYWNrIHRvIGRlZmF1bHRzLiBEb2VzIG5vdCByZXNldDpcclxuICogYWN0aXZlVGFiSWRcclxuICogYWN0aXZlVGFiSG9zdG5hbWVcclxuKi9cclxuZnVuY3Rpb24gb25SZXNldCgpIHtcclxuICBsZXQgZGVmYXVsdFN0YXRlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShERUZBVUxUX1NUQVRFKSk7XHJcbiAgc3RhdGUuaG9zdHMgPSBkZWZhdWx0U3RhdGUuaG9zdHM7XHJcbiAgc3RhdGUuZmcgPSBkZWZhdWx0U3RhdGUuZmc7XHJcbiAgc3RhdGUuYmcgPSBkZWZhdWx0U3RhdGUuYmc7XHJcbiAgc3RhdGUubGkgPSBkZWZhdWx0U3RhdGUubGk7XHJcbiAgc3RhdGUuYWN0aXZlQnRuID0gZGVmYXVsdFN0YXRlLmFjdGl2ZUJ0bjtcclxuICBzdGF0ZS5saWdodG5lc3MgPSBkZWZhdWx0U3RhdGUubGlnaHRuZXNzO1xyXG4gIHN0YXRlLmxvc3RDb25uZWN0aW9uID0gZGVmYXVsdFN0YXRlLmxvc3RDb25uZWN0aW9uO1xyXG4gIHN0YXRlLmludmFsaWRVcmwgPSBkZWZhdWx0U3RhdGUuaW52YWxpZFVybDtcclxuXHJcbiAgdXBkYXRlQ29udGV4dE1lbnUoKTtcclxuICBzZW5kVGFiTWVzc2FnZSh7IG1lc3NhZ2U6IFVQREFURV9DT05URU5ULCBwYXlsb2FkOiBzdGF0ZSB9KTtcclxuICBzYXZlU3RhdGUoc3RhdGUpO1xyXG59XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gdGFic1xyXG4vKiogT24gdGFiIGFjdGl2YXRpb24sIGdldCB0aGUgZnVsbCB0YWIgZGF0YS4gKi9cclxuZnVuY3Rpb24gb25UYWJBY3RpdmF0ZWQodGFiSW5mbzogY2hyb21lLnRhYnMuVGFiQWN0aXZlSW5mbykge1xyXG4gIGxvZ3MgJiYgY29uc29sZS5sb2coJ3RhYiBhY3RpdmF0ZWQnLCB0YWJJbmZvLnRhYklkKTtcclxuICBzdGF0ZS5hY3RpdmVUYWJJZCA9IHRhYkluZm8udGFiSWQ7XHJcbiAgc2F2ZVN0YXRlKHN0YXRlKTtcclxuICBjaHJvbWUudGFicy5nZXQodGFiSW5mby50YWJJZCwgdmFsaWRhdGVUYWIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvblRhYlVwZGF0ZWQodGFiSWQ6IG51bWJlciwgY2hhbmdlSW5mbzogYW55LCB0YWI6IGNocm9tZS50YWJzLlRhYikge1xyXG4gIGxvZ3MgJiYgY29uc29sZS5sb2coJ3RhYlVkcGF0ZWQnLCB0YWIpO1xyXG4gIGxvZ3MgJiYgY29uc29sZS5sb2coJ2NoYW5nZUluZm8nLCBjaGFuZ2VJbmZvKTtcclxuICBpZiAoc3RhdGUuYWN0aXZlVGFiSWQgPT09IElOVkFMSURfVEFCKSB7XHJcbiAgICAvLyBUYWIgSUQgY2FuIGJlIGludmFsaWQgaWYgdGhlIGJyb3dzZXIgd2FzIGZpcnN0IGxvYWRlZC5cclxuICAgIHN0YXRlLmFjdGl2ZVRhYklkID0gdGFiSWQ7XHJcbiAgICB2YWxpZGF0ZVRhYih0YWIpO1xyXG4gIH0gZWxzZSBpZiAoc3RhdGUuYWN0aXZlVGFiSWQgPT09IHRhYklkKSB7XHJcbiAgICB2YWxpZGF0ZVRhYih0YWIpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqIENoZWNrIGlmIHRoZSBjdXJyZW50IHRhYiBpcyB2YWxpZCB0byBjaGFuZ2UgY29sb3JzLiBJZiBpdCBpcywgc2F2ZSBzdG9yYWdlIHdpdGggdGhlIGFjdGl2ZSB0YWIuICovXHJcbmZ1bmN0aW9uIHZhbGlkYXRlVGFiKHRhYjogY2hyb21lLnRhYnMuVGFiKSB7XHJcbiAgbG9ncyAmJiBjb25zb2xlLmxvZygndmFsaWRhdGluZyB0YWInLCB0YWIpO1xyXG4gIHN0YXRlLmludmFsaWRVcmwgPSBmYWxzZTtcclxuICBzdGF0ZS5sb3N0Q29ubmVjdGlvbiA9IGZhbHNlO1xyXG4gIHNhdmVTdGF0ZShzdGF0ZSk7XHJcblxyXG4gIC8vIGxvZ3MgJiYgY29uc29sZS5sb2coJ3ZhbGlkYXRlIHRhYicsIHRhYik7XHJcbiAgaWYgKCF0YWIudXJsKSB7XHJcbiAgICAvLyBUaGlzIG1heSBiZSBudWxsIHVudGlsIHRoZSB0YWIgaXMgdXBkYXRlZC5cclxuICAgIHJldHVybjtcclxuICB9O1xyXG5cclxuICBsZXQgdXJsID0gbmV3IFVSTCh0YWIudXJsKTtcclxuICBsb2dzICYmIGNvbnNvbGUubG9nKCd1cmwuaG9zdG5hbWUnLCB1cmwuaG9zdG5hbWUpO1xyXG5cclxuICBpZiAoIXVybC5ob3N0bmFtZSkge1xyXG4gICAgbG9ncyAmJiBjb25zb2xlLmxvZygnSW52YWxpZCBob3N0bmFtZScsIHVybC5ob3N0bmFtZSk7XHJcbiAgICBzZXRJbnZhbGlkVXJsKClcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGlmICh1cmwucHJvdG9jb2wgPT09ICdjaHJvbWU6JyB8fCB1cmwucHJvdG9jb2wgPT09ICdhYm91dDonKSB7XHJcbiAgICBsb2dzICYmIGNvbnNvbGUubG9nKCdJbnZhbGlkIHByb3RvY29sJywgdXJsLnByb3RvY29sKTtcclxuICAgIHNldEludmFsaWRVcmwoKVxyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgaWYgKHVybC5ob3N0bmFtZSA9PT0gXCJhZGRvbnMubW96aWxsYS5vcmdcIikge1xyXG4gICAgbG9ncyAmJiBjb25zb2xlLmxvZygnSW52YWxpZCBob3N0bmFtZScsIHVybC5ob3N0bmFtZSk7XHJcbiAgICBzZXRJbnZhbGlkVXJsKClcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIHN0YXRlLmFjdGl2ZVRhYkhvc3RuYW1lID0gdXJsLmhvc3RuYW1lO1xyXG4gIHNhdmVTdGF0ZShzdGF0ZSk7XHJcblxyXG4gIHVwZGF0ZUNvbnRleHRNZW51KCk7XHJcbiAgc2VuZFRhYk1lc3NhZ2UoeyBtZXNzYWdlOiBVUERBVEVfQ09OVEVOVCwgcGF5bG9hZDogc3RhdGUgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldEludmFsaWRVcmwoKSB7XHJcbiAgc3RhdGUuYWN0aXZlVGFiSG9zdG5hbWUgPSBcIlwiO1xyXG4gIHN0YXRlLmludmFsaWRVcmwgPSB0cnVlO1xyXG4gIHNhdmVTdGF0ZShzdGF0ZSk7XHJcbn1cclxuXHJcbi8vKiogU2VuZCBtZXNzYWdlIHRvIGEgdGFiLiBJZiB0aGUgZXh0ZW5zaW9uIHdhcyByZWxvYWRlZCwgdGhlIHRhYiB3aWxsIG5vdCBiZSBhYmxlIHRvIHJlY2VpdmUgYW55IG1lc3NhZ2VzIHVudGlsIHJlbG9hZGVkLCBoZW5jZSB0aGUgY2F0Y2ggYmxvY2suICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNlbmRUYWJNZXNzYWdlKG1lc3NhZ2U6IE1lc3NhZ2UpIHtcclxuICBpZiAoIXN0YXRlLmFjdGl2ZVRhYklkKSB7XHJcbiAgICBsb2dzICYmIGNvbnNvbGUubG9nKCdObyBhY3RpdmUgdGFiIElELicpO1xyXG4gICAgcmV0dXJuXHJcbiAgfTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGxvZ3MgJiYgY29uc29sZS5sb2coJ1NlbnQgY29udGVudCBtZXNzYWdlLicpO1xyXG4gICAgYXdhaXQgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2Uoc3RhdGUuYWN0aXZlVGFiSWQsIG1lc3NhZ2UpO1xyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgbG9ncyAmJiBjb25zb2xlLmxvZyhcInNlbmRUYWJNZXNzYWdlIGVycm9yXCIsIGVycik7XHJcbiAgICBzdGF0ZS5sb3N0Q29ubmVjdGlvbiA9IHRydWU7XHJcbiAgICBzYXZlU3RhdGUoc3RhdGUpO1xyXG4gIH1cclxufVxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGNvbnRleHQgbWVudVxyXG5mdW5jdGlvbiBjcmVhdGVDb250ZXh0TWVudSgpIHtcclxuICBsZXQgbWVudTogb2JqZWN0ID0ge1xyXG4gICAgaWQ6IENIQU5HRV9DT0xPUlMsXHJcbiAgICB0aXRsZTogXCJDaGFuZ2UgQ29sb3JzXCIsXHJcbiAgICB0eXBlOiBcImNoZWNrYm94XCIsXHJcbiAgICBjaGVja2VkOiBzaG91bGRDaGFuZ2VDb2xvcnMoc3RhdGUpLFxyXG4gIH07XHJcblxyXG4gIGNocm9tZS5jb250ZXh0TWVudXMucmVtb3ZlQWxsKCk7XHJcbiAgY2hyb21lLmNvbnRleHRNZW51cy5jcmVhdGUobWVudSk7XHJcbiAgY2hyb21lLmNvbnRleHRNZW51cy5vbkNsaWNrZWQucmVtb3ZlTGlzdGVuZXIob25Db250ZXh0TWVudUNsaWNrZWQpO1xyXG4gIGNocm9tZS5jb250ZXh0TWVudXMub25DbGlja2VkLmFkZExpc3RlbmVyKG9uQ29udGV4dE1lbnVDbGlja2VkKTtcclxufVxyXG5cclxuZnVuY3Rpb24gb25Db250ZXh0TWVudUNsaWNrZWQoaW5mbzogY2hyb21lLmNvbnRleHRNZW51cy5PbkNsaWNrRGF0YSwgX3RhYj86IGNocm9tZS50YWJzLlRhYikge1xyXG4gIGlmIChpbmZvLm1lbnVJdGVtSWQgPT09IENIQU5HRV9DT0xPUlMpIHtcclxuICAgIG9uQ2hhbmdlQ29sb3JzKCEhaW5mby5jaGVja2VkKVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlQ29udGV4dE1lbnUoKSB7XHJcbiAgY2hyb21lLmNvbnRleHRNZW51cy51cGRhdGUoQ0hBTkdFX0NPTE9SUywgeyBjaGVja2VkOiBzaG91bGRDaGFuZ2VDb2xvcnMoc3RhdGUpIH0pO1xyXG59XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gaW5zdGFsbGVkXHJcbmZ1bmN0aW9uIG9uSW5zdGFsbGVkKGRldGFpbHM6IGFueSkge1xyXG4gIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvTW96aWxsYS9BZGQtb25zL1dlYkV4dGVuc2lvbnMvQVBJL3J1bnRpbWUvT25JbnN0YWxsZWRSZWFzb25cclxuICBpZiAoZGV0YWlscy5yZWFzb24gPT09ICd1cGRhdGUnKSB7XHJcbiAgICAvLyBvbmx5IGRvIHRoaXMgZm9yIG1ham9yIHZlcnNpb25zIHdpdGggYnJlYWtpbmcgY2hhbmdlc1xyXG4gICAgLy8gY2xlYXJTdG9yYWdlKGluaXRTZXJ2aWNlV29ya2VyKTtcclxuICB9IGVsc2UgaWYgKGRldGFpbHMucmVhc29uID09PSAnaW5zdGFsbCcpIHtcclxuICAgIC8vIHNob3dBYm91dFBhZ2UoZGV0YWlscy5yZWFzb24pO1xyXG4gIH1cclxufVxyXG5cclxuLy8gZnVuY3Rpb24gc2hvd0Fib3V0UGFnZShyZWFzb246IHN0cmluZykge1xyXG4vLyAgIGNocm9tZS50YWJzLmNyZWF0ZSh7IHVybDogY2hyb21lLnJ1bnRpbWUuZ2V0VVJMKGBhYm91dC9hYm91dC5odG1sP3JlYXNvbj0ke3JlYXNvbn1gKSB9KTtcclxuLy8gfVxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHN0b3JhZ2VcclxuZnVuY3Rpb24gY2xlYXJTdG9yYWdlKCkge1xyXG4gIGNocm9tZS5zdG9yYWdlLnN5bmMucmVtb3ZlKFwiY29sb3JDaGFuZ2VyU3RhdGVcIik7XHJcbn1cclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBsaXN0ZW5lcnNcclxuY2hyb21lLnRhYnMub25BY3RpdmF0ZWQuYWRkTGlzdGVuZXIob25UYWJBY3RpdmF0ZWQpO1xyXG5jaHJvbWUudGFicy5vblVwZGF0ZWQuYWRkTGlzdGVuZXIob25UYWJVcGRhdGVkKTtcclxuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKG9uTWVzc2FnZSk7XHJcbmNocm9tZS5ydW50aW1lLm9uSW5zdGFsbGVkLmFkZExpc3RlbmVyKG9uSW5zdGFsbGVkKTtcclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBpbml0XHJcbi8qKiBHZXQgc3RhdGUgZnJvbSBzdG9yYWdlIGlmIGl0IGV4aXN0cy4gSWYgbm90LCBjcmVhdGUgZGVmYXVsdCBzdGF0ZS4gKi9cclxuYXN5bmMgZnVuY3Rpb24gaW5pdFNlcnZpY2VXb3JrZXIoKSB7XHJcbiAgbGV0IHN0b3JhZ2UgPSBhd2FpdCBnZXRTdGF0ZSgpO1xyXG4gIGlmIChzdG9yYWdlPy5jb2xvckNoYW5nZXJTdGF0ZSkge1xyXG4gICAgc3RhdGUgPSBzdG9yYWdlLmNvbG9yQ2hhbmdlclN0YXRlO1xyXG4gIH1cclxuXHJcbiAgLy8gSW5pdGlhbGl6ZSB0YWJzLlxyXG4gIHN0YXRlLmFjdGl2ZVRhYklkID0gSU5WQUxJRF9UQUI7XHJcbiAgc3RhdGUuYWN0aXZlVGFiSG9zdG5hbWUgPSBcIlwiO1xyXG5cclxuICBsZXQgdGFicyA9IGF3YWl0IHRhYnNRdWVyeSh7IGN1cnJlbnRXaW5kb3c6IHRydWUsIGFjdGl2ZTogdHJ1ZSB9KTtcclxuICBpZiAodGFicy5sZW5ndGggPiAwKSB7XHJcbiAgICBsZXQgdGFiID0gdGFic1swXTtcclxuICAgIGlmICh0YWIuaWQpIHtcclxuICAgICAgc3RhdGUuYWN0aXZlVGFiSWQgPSB0YWIuaWQ7XHJcbiAgICAgIHZhbGlkYXRlVGFiKHRhYik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBsb2dzICYmIGNvbnNvbGUubG9nKCdzdGF0ZScsIHN0YXRlKTtcclxuXHJcbiAgY3JlYXRlQ29udGV4dE1lbnUoKTtcclxuICBzYXZlU3RhdGUoc3RhdGUpO1xyXG59XHJcblxyXG5pbml0U2VydmljZVdvcmtlcigpO1xyXG5cclxuLy8gY2FuIHBvdGVudGlhbGx5IHVzZSB0aGlzIHRvIGNoZWNrIGZvciBlcnJvcnNcclxuLy8gZnVuY3Rpb24gaGFzRXJyb3IoKSB7XHJcbi8vICAgaWYgKGJJc0Nocm9tZSAmJiBjaHJvbWUucnVudGltZS5sYXN0RXJyb3IpIHtcclxuLy8gICAgICAgcmV0dXJuIHRydWU7XHJcbi8vICAgfSBlbHNlIGlmIChicm93c2VyLnJ1bnRpbWUubGFzdEVycm9yKSB7XHJcbi8vICAgICByZXR1cm4gdHJ1ZTtcclxuLy8gICB9XHJcbi8vICAgcmV0dXJuIGZhbHNlO1xyXG4vLyB9XHJcbiJdLCJuYW1lcyI6WyIkZmZhMGRiZWEzYzBjMjFlNCRleHBvcnQkNjQ0NmExODZkMDllMzc5ZSIsInRlc3QiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCIkZmZhMGRiZWEzYzBjMjFlNCRleHBvcnQkNWU4NzA3ODg4YTg3ZDY5NSIsImh1ZSIsInNhdHVyYXRpb24iLCJsaWdodG5lc3MiLCJjaG9zZW5JZCIsImNvbG9yIiwic3dhdGNoIiwiaHNsIiwibGlnaHRuZXNzU2hpZnQiLCJodWVIb3ZlcmVkIiwiaHVlVmlzaXRlZCIsImFscGhhIiwiJGZmYTBkYmVhM2MwYzIxZTQkZXhwb3J0JGZiNzY5ODU1MGI0MWY3MWEiLCIkZmZhMGRiZWEzYzBjMjFlNCRleHBvcnQkNzg5NjFlYTgxY2FiMDFhIiwic3RhdGUiLCJhY3RpdmVUYWJIb3N0bmFtZSIsImFjdGl2ZVRhYklkIiwiaG9zdHMiLCJpbmNsdWRlcyIsIiRmZmEwZGJlYTNjMGMyMWU0JGV4cG9ydCRmYjkzMWNkNTk4OTIxNDkyIiwiY2hyb21lIiwic3RvcmFnZSIsInN5bmMiLCJzZXQiLCJjb2xvckNoYW5nZXJTdGF0ZSIsImJyb3dzZXIiLCIkYTRmZjZmYmUzNTViYzYwNyRleHBvcnQkYzA2NmVlNzJiMjVmNjBjNCIsIiRhNGZmNmZiZTM1NWJjNjA3JGV4cG9ydCQ5MTY2YTNmMGI5NzEzMzE5IiwiJGE0ZmY2ZmJlMzU1YmM2MDckZXhwb3J0JGZiOWZmMmY5MmY1YThmMWUiLCIkYTRmZjZmYmUzNTViYzYwNyRleHBvcnQkZTdlMzRjNDJiNzM5MjVkYiIsIiRhNGZmNmZiZTM1NWJjNjA3JGV4cG9ydCRjMmQ2ZTI1OTU1ZDNjZmUyIiwiJGE0ZmY2ZmJlMzU1YmM2MDckZXhwb3J0JDc3ZTJiZTdmZTE1MWZjZTIiLCIkYTRmZjZmYmUzNTViYzYwNyRleHBvcnQkYTNhNmEyOGFlODgyM2IwNiIsImZnIiwiYmciLCJsaSIsImFjdGl2ZUJ0biIsImxvc3RDb25uZWN0aW9uIiwiaW52YWxpZFVybCIsIiQ2ZTU5NTI2NDQxZDY4YzRhJHZhciRzdGF0ZSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsIiQ2ZTU5NTI2NDQxZDY4YzRhJHZhciRvbkNoYW5nZUNvbG9ycyIsImNoYW5nZUNvbG9ycyIsInB1c2giLCJmaWx0ZXIiLCJob3N0IiwiJDZlNTk1MjY0NDFkNjhjNGEkdmFyJHVwZGF0ZUNvbnRleHRNZW51IiwiJDZlNTk1MjY0NDFkNjhjNGEkdmFyJHNlbmRUYWJNZXNzYWdlIiwibWVzc2FnZSIsInBheWxvYWQiLCIkNmU1OTUyNjQ0MWQ2OGM0YSR2YXIkdXBkYXRlQ29sb3IiLCJpZCIsIiQ2ZTU5NTI2NDQxZDY4YzRhJHZhciR2YWxpZGF0ZVRhYiIsInRhYiIsInVybCIsIlVSTCIsImhvc3RuYW1lIiwicHJvdG9jb2wiLCIkNmU1OTUyNjQ0MWQ2OGM0YSR2YXIkc2V0SW52YWxpZFVybCIsInRhYnMiLCJzZW5kTWVzc2FnZSIsImVyciIsIiQ2ZTU5NTI2NDQxZDY4YzRhJHZhciRvbkNvbnRleHRNZW51Q2xpY2tlZCIsImluZm8iLCJfdGFiIiwibWVudUl0ZW1JZCIsImNoZWNrZWQiLCJjb250ZXh0TWVudXMiLCJ1cGRhdGUiLCJvbkFjdGl2YXRlZCIsImFkZExpc3RlbmVyIiwidGFiSW5mbyIsInRhYklkIiwiZ2V0Iiwib25VcGRhdGVkIiwiY2hhbmdlSW5mbyIsInJ1bnRpbWUiLCJvbk1lc3NhZ2UiLCJfc2VuZGVyIiwic2VuZFJlc3BvbnNlIiwiYnV0dG9uIiwiJDZlNTk1MjY0NDFkNjhjNGEkdmFyJG9uU2V0QWN0aXZlQnV0dG9uIiwiJDZlNTk1MjY0NDFkNjhjNGEkdmFyJG9uVXBkYXRlQ2hvc2VuQ29sb3IiLCIkNmU1OTUyNjQ0MWQ2OGM0YSR2YXIkb25DaGFuZ2VMaWdodG5lc3MiLCJkZWZhdWx0U3RhdGUiLCIkNmU1OTUyNjQ0MWQ2OGM0YSR2YXIkb25SZXNldCIsIm9uSW5zdGFsbGVkIiwiZGV0YWlscyIsInJlYXNvbiIsImFzeW5jIiwicXVlcnkiLCJjdXJyZW50V2luZG93IiwiYWN0aXZlIiwibGVuZ3RoIiwibWVudSIsInRpdGxlIiwidHlwZSIsInJlbW92ZUFsbCIsImNyZWF0ZSIsIm9uQ2xpY2tlZCIsInJlbW92ZUxpc3RlbmVyIiwiJDZlNTk1MjY0NDFkNjhjNGEkdmFyJGNyZWF0ZUNvbnRleHRNZW51Il0sInZlcnNpb24iOjMsImZpbGUiOiJiYWNrZ3JvdW5kLkhBU0hfUkVGXzQ4YjFjOWEyN2NjMmY2YjAuanMubWFwIn0=
