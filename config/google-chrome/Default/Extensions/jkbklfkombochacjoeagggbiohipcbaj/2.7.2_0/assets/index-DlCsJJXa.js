import{d as y}from"./const-VfW2e5AY.js";const d={};let w=!1;function M(){w=!0,chrome.runtime.onMessage.addListener((e,o,n)=>{if(e.isSendMessageToBackgroundMessage&&d[e.type]){const i=d[e.type].map(u=>u(...e.args)).pop();return i.then?(i.then(u=>{n(u)}),!0):n(i)}})}const p={};let N=!1;function R(){N=!0,chrome.runtime.onMessageExternal.addListener((e,o,n)=>{var i,u;if((i=o==null?void 0:o.url)!=null&&i.startsWith("https://esuit.dev")&&p[e.type]){const c=p[e.type].map(t=>t(e.args,o)).pop();if(e.callbackFnName&&(u=o.tab)!=null&&u.id){const t=o.tab.id;c&&c.then?c.then(a=>{chrome.scripting.executeScript({target:{tabId:t},world:"MAIN",args:[a??!1,e.callbackFnName],func:(r,s)=>{try{window[s](r)}catch(l){console.error(l)}}})}):chrome.scripting.executeScript({target:{tabId:t},world:"MAIN",args:[c??!1,e.callbackFnName],func:(a,r)=>{try{window[r](a)}catch(s){console.error(s)}}})}return!0}})}async function U(e,...o){if(A()){if(d[e])return d[e].map(n=>n(...o)).pop();throw new Error(`no handler for ${e}`)}return await chrome.runtime.sendMessage({isSendMessageToBackgroundMessage:!0,type:e,args:o})}function C(e,o){return!w&&M(),d[e]=d[e]||[],d[e].push(o),()=>{const n=d.indexOf(o);d.splice(n,1)}}function L(e,o){return!N&&R(),p[e]=p[e]||[],p[e].push(o),()=>{const n=p.indexOf(o);p.splice(n,1)}}function A(){return!!~location.pathname.indexOf("service-worker-loader.js")}var O=(e=>(e[e.FREE=0]="FREE",e[e.BASIC=1]="BASIC",e[e.PREMIUM=2]="PREMIUM",e))(O||{}),S=(e=>(e[e.SUBSCRIPTION=0]="SUBSCRIPTION",e[e.ONETIME_PAYMENT=1]="ONETIME_PAYMENT",e))(S||{}),I=(e=>(e[e.ONE_MONTH=1]="ONE_MONTH",e[e.THREE_MONTH=3]="THREE_MONTH",e[e.SIX_MONTH=6]="SIX_MONTH",e[e.A_YEAR=12]="A_YEAR",e))(I||{}),P=(e=>(e[e.STRIPE=0]="STRIPE",e[e.PAYPAL=1]="PAYPAL",e))(P||{}),_=(e=>(e[e.FACEBOOK=0]="FACEBOOK",e[e.INSTAGRAM=1]="INSTAGRAM",e))(_||{}),k=(e=>(e.SUBSCRIPTION="paypal_subscription",e.PAYMENT="paypal_payment",e))(k||{}),b=(e=>(e.RETURN_PAGE="RETURN_PAGE",e.RETURN_EXT="RETURN_EXT",e.RETURN_EXT_LOCAL="RETURN_EXT_LOCAL",e))(b||{});function T(e,o){Object.keys(e).map(n=>o(e[n],n,e))}function m(e,o){function n(c,t){switch(c.type){case"object":return i(c,t);case"array":return u(c,t);default:return t!==void 0?t:c.default!==void 0?c.default:void 0}}function i(c,t){const a={},r=c.properties??{};return T(r,(s,l)=>{if(c.required.includes(l)||t!==void 0&&t[l]!==void 0){let h=t!==void 0?t[l]:void 0;!s.properties&&s.default&&s.type==="object"&&s.additionalProperties&&(h=s.default),a[l]=n(s,h)}}),t&&T(t,(s,l)=>{a[l]===void 0&&s!==void 0&&(a[l]=s)}),a}function u(c,t){if(t===void 0)return c.default?c.default:void 0;const a=[];for(let r=0;r<t.length;r++)a.push(n(c.items??{},t[r]));return a}return n(o,e)}const g="__storage-local-version";function E(e){const o=Object.keys(e);chrome.runtime.onInstalled.addListener(i=>{(i.reason==="install"||i.reason==="update")&&n()});async function n(){let i=(await chrome.storage.local.get(g))[g];const u=chrome.runtime.getManifest().version;if(u!==i){const c=await chrome.storage.local.get(o),t=o.reduce((a,r)=>{let s=c[r]||{};return s=m(s,e[r]),a[r]=s,a},{[g]:u});await chrome.storage.local.set(t)}}}function H(e,o){async function n(t){let a;return await navigator.locks.request(f(t),{mode:"shared"},async()=>{a=(await v(t))[t]}),a===void 0&&(a=m(a,e[t])),a}async function i(t,a){await navigator.locks.request(f(t),{mode:"exclusive"},async()=>{let r=(await v(t))[t];r===void 0&&(r=m(r,e[t]));const s=await a(r);await chrome.storage.local.set({[t]:s})})}async function u(t,a){await navigator.locks.request(f(t),{mode:"exclusive"},async()=>{let r=a||{};a||(r=m(r,e[t])),await chrome.storage.local.set({[t]:r})})}async function c(t){return await navigator.locks.request(f(t),{mode:"exclusive"},async()=>{await chrome.storage.local.remove([t])}),Promise.resolve()}return{updateBucket:i,setBucket:u,getBucket:n,deleteBucket:c}}function f(e){return`storage.local.${e}`}function v(e){return new Promise(o=>{chrome.storage.local.get(e,n=>{o(n)})})}const B={type:"object",properties:{counts:{type:"object",properties:{},default:{...y}},haveShared:{type:"boolean",default:!1},lastTimeShowedPromotionPage:{type:"number",default:0}},required:["counts","doNotShow","lastTimeShowedPromotionPage"],default:{}},j={global:B};export{b as M,j as S,O as T,U as k,C as m,H as p,L as w,E as y};
